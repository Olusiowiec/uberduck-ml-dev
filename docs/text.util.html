---

title: Title


keywords: fastai
sidebar: home_sidebar



nb_path: "nbs/text.util.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/text.util.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><h1>Table of Contents<span class="tocSkip"></span></h1></p>
<div class="toc"><ul class="toc-item"></ul></div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><h1>Table of Contents<span class="tocSkip"></span></h1></p>
<div class="toc"><ul class="toc-item"></ul></div>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="normalize_numbers" class="doc_header"><code>normalize_numbers</code><a href="https://github.com/uberduck-ai/uberduck_ml_dev/tree/master/uberduck_ml_dev/text/util.py#L117" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>normalize_numbers</code>(<strong><code>text</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="expand_abbreviations" class="doc_header"><code>expand_abbreviations</code><a href="https://github.com/uberduck-ai/uberduck_ml_dev/tree/master/uberduck_ml_dev/text/util.py#L127" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>expand_abbreviations</code>(<strong><code>text</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="expand_numbers" class="doc_header"><code>expand_numbers</code><a href="https://github.com/uberduck-ai/uberduck_ml_dev/tree/master/uberduck_ml_dev/text/util.py#L133" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>expand_numbers</code>(<strong><code>text</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="lowercase" class="doc_header"><code>lowercase</code><a href="https://github.com/uberduck-ai/uberduck_ml_dev/tree/master/uberduck_ml_dev/text/util.py#L137" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>lowercase</code>(<strong><code>text</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="collapse_whitespace" class="doc_header"><code>collapse_whitespace</code><a href="https://github.com/uberduck-ai/uberduck_ml_dev/tree/master/uberduck_ml_dev/text/util.py#L141" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>collapse_whitespace</code>(<strong><code>text</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="convert_to_ascii" class="doc_header"><code>convert_to_ascii</code><a href="https://github.com/uberduck-ai/uberduck_ml_dev/tree/master/uberduck_ml_dev/text/util.py#L145" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>convert_to_ascii</code>(<strong><code>text</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="convert_to_arpabet" class="doc_header"><code>convert_to_arpabet</code><a href="https://github.com/uberduck-ai/uberduck_ml_dev/tree/master/uberduck_ml_dev/text/util.py#L148" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>convert_to_arpabet</code>(<strong><code>text</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="basic_cleaners" class="doc_header"><code>basic_cleaners</code><a href="https://github.com/uberduck-ai/uberduck_ml_dev/tree/master/uberduck_ml_dev/text/util.py#L156" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>basic_cleaners</code>(<strong><code>text</code></strong>)</p>
</blockquote>
<p>Basic pipeline that lowercases and collapses whitespace without transliteration.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="transliteration_cleaners" class="doc_header"><code>transliteration_cleaners</code><a href="https://github.com/uberduck-ai/uberduck_ml_dev/tree/master/uberduck_ml_dev/text/util.py#L163" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>transliteration_cleaners</code>(<strong><code>text</code></strong>)</p>
</blockquote>
<p>Pipeline for non-English text that transliterates to ASCII.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="english_cleaners" class="doc_header"><code>english_cleaners</code><a href="https://github.com/uberduck-ai/uberduck_ml_dev/tree/master/uberduck_ml_dev/text/util.py#L170" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>english_cleaners</code>(<strong><code>text</code></strong>)</p>
</blockquote>
<p>Pipeline for English text, including number and abbreviation expansion.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="n">convert_to_arpabet</span><span class="p">(</span><span class="s2">&quot;Dictionary&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;{ D IH1 K SH AH0 N EH2 R IY0 }&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="clean_text" class="doc_header"><code>clean_text</code><a href="https://github.com/uberduck-ai/uberduck_ml_dev/tree/master/uberduck_ml_dev/text/util.py#L196" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>clean_text</code>(<strong><code>text</code></strong>, <strong><code>cleaner_names</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="english_to_arpabet" class="doc_header"><code>english_to_arpabet</code><a href="https://github.com/uberduck-ai/uberduck_ml_dev/tree/master/uberduck_ml_dev/text/util.py#L203" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>english_to_arpabet</code>(<strong><code>english_text</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="text_to_sequence" class="doc_header"><code>text_to_sequence</code><a href="https://github.com/uberduck-ai/uberduck_ml_dev/tree/master/uberduck_ml_dev/text/util.py#L207" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>text_to_sequence</code>(<strong><code>text</code></strong>, <strong><code>cleaner_names</code></strong>, <strong><code>p_arpabet</code></strong>=<em><code>0.0</code></em>)</p>
</blockquote>
<p>Converts a string of text to a sequence of IDs corresponding to the symbols in the text.
The text can optionally have ARPAbet sequences enclosed in curly braces embedded
in it. For example, "Turn left on {HH AW1 S S T AH0 N} Street."
Args:
  text: string to convert to a sequence
  cleaner_names: names of the cleaner functions to run the text through
Returns:
  List of integers corresponding to the symbols in the text</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="sequence_to_text" class="doc_header"><code>sequence_to_text</code><a href="https://github.com/uberduck-ai/uberduck_ml_dev/tree/master/uberduck_ml_dev/text/util.py#L247" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>sequence_to_text</code>(<strong><code>sequence</code></strong>)</p>
</blockquote>
<p>Converts a sequence of IDs back to a string</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">text_to_sequence</span><span class="p">(</span><span class="s2">&quot;The pen is blue.&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;english_cleaners&quot;</span><span class="p">]))</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">text_to_sequence</span><span class="p">(</span><span class="s2">&quot;The pen is blue.&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;english_cleaners&quot;</span><span class="p">]))</span> <span class="o">==</span> <span class="mi">16</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">text_to_sequence</span><span class="p">(</span><span class="s2">&quot;The pen is {B L OW0}.&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;english_cleaners&quot;</span><span class="p">]))</span> <span class="o">==</span> <span class="mi">15</span>
<span class="k">assert</span> <span class="p">(</span>
    <span class="n">sequence_to_text</span><span class="p">(</span><span class="n">text_to_sequence</span><span class="p">(</span><span class="s2">&quot;The pen is blue.&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;english_cleaners&quot;</span><span class="p">]))</span>
    <span class="o">==</span> <span class="s2">&quot;the pen is blue.&quot;</span>
<span class="p">)</span>
<span class="k">assert</span> <span class="p">(</span>
    <span class="n">sequence_to_text</span><span class="p">(</span><span class="n">text_to_sequence</span><span class="p">(</span><span class="s2">&quot;The pen is {B L OW0}.&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;english_cleaners&quot;</span><span class="p">]))</span>
    <span class="o">==</span> <span class="s2">&quot;the pen is {B L OW0}.&quot;</span>
<span class="p">)</span>
<span class="k">assert</span> <span class="p">(</span>
    <span class="nb">len</span><span class="p">(</span>
        <span class="n">text_to_sequence</span><span class="p">(</span>
            <span class="s2">&quot;{N AA1 T} {B AE1 D} {B AA1 R T}, {N AA1 T} {B AE1 D} {AE1 T} {AO1 L}.&quot;</span><span class="p">,</span>
            <span class="p">[</span><span class="s2">&quot;english_cleaners&quot;</span><span class="p">],</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="o">==</span> <span class="mi">28</span>
<span class="p">)</span>

<span class="k">assert</span> <span class="p">(</span>
    <span class="nb">len</span><span class="p">(</span>
        <span class="n">text_to_sequence</span><span class="p">(</span>
            <span class="s2">&quot;Not bad bart, not bad at all.&quot;</span><span class="p">,</span>
            <span class="p">[</span><span class="s2">&quot;english_cleaners&quot;</span><span class="p">],</span>
            <span class="n">p_arpabet</span><span class="o">=</span><span class="mf">1.0</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="o">==</span> <span class="mi">28</span>
<span class="p">)</span>
<span class="n">seq</span> <span class="o">=</span> <span class="n">text_to_sequence</span><span class="p">(</span>
    <span class="s2">&quot;Not bad bart, not bad at all.&quot;</span><span class="p">,</span>
    <span class="p">[</span><span class="s2">&quot;english_cleaners&quot;</span><span class="p">],</span>
    <span class="n">p_arpabet</span><span class="o">=</span><span class="mf">1.0</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sequence_to_text</span><span class="p">(</span><span class="n">seq</span><span class="p">))</span>
<span class="n">seq2</span> <span class="o">=</span> <span class="n">text_to_sequence</span><span class="p">(</span>
    <span class="s2">&quot;{N AA1 T} {B AE1 D} {B AA1 R T} , {N AA1 T} {B AE1 D} {AE1 T} {AO1 L} .&quot;</span><span class="p">,</span>
    <span class="p">[</span><span class="s2">&quot;english_cleaners&quot;</span><span class="p">],</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sequence_to_text</span><span class="p">(</span><span class="n">seq2</span><span class="p">))</span>
<span class="n">seq3</span> <span class="o">=</span> <span class="n">text_to_sequence</span><span class="p">(</span>
    <span class="s2">&quot;Not bad bart, not bad at all.&quot;</span><span class="p">,</span>
    <span class="p">[</span><span class="s2">&quot;english_cleaners&quot;</span><span class="p">],</span>
    <span class="n">p_arpabet</span><span class="o">=</span><span class="mf">0.5</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sequence_to_text</span><span class="p">(</span><span class="n">seq3</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[94, 82, 79, 8, 90, 79, 88, 8, 83, 93, 8, 76, 86, 95, 79, 4]
{N AA1 T} {B AE1 D} {B AA1 R T}, {N AA1 T} {B AE1 D} {AE1 T} {AO1 L}.
{N AA1 T} {B AE1 D} {B AA1 R T} , {N AA1 T} {B AE1 D} {AE1 T} {AO1 L} .
not {B AE1 D} {B AA1 R T}, {N AA1 T} {B AE1 D} at all.
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">uberduck_ml_dev.text.symbols</span> <span class="kn">import</span> <span class="n">symbols</span><span class="p">,</span> <span class="n">symbol_to_id</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">symbol_to_id</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

