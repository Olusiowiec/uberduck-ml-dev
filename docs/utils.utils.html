---

title: Title


keywords: fastai
sidebar: home_sidebar



nb_path: "nbs/utils.utils.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/utils.utils.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><h1>Table of Contents<span class="tocSkip"></span></h1></p>
<div class="toc"><ul class="toc-item"></ul></div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><h1>Table of Contents<span class="tocSkip"></span></h1></p>
<div class="toc"><ul class="toc-item"></ul></div>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="load_filepaths_and_text" class="doc_header"><code>load_filepaths_and_text</code><a href="https://github.com/uberduck-ai/uberduck_ml_dev/tree/master/uberduck_ml_dev/utils/utils.py#L116" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>load_filepaths_and_text</code>(<strong><code>filename</code></strong>, <strong><code>split</code></strong>=<em><code>'|'</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="synthesize_speakerids2" class="doc_header"><code>synthesize_speakerids2</code><a href="https://github.com/uberduck-ai/uberduck_ml_dev/tree/master/uberduck_ml_dev/utils/utils.py#L27" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>synthesize_speakerids2</code>(<strong><code>filelists</code></strong>, <strong><code>fix_indices_index</code></strong>=<em><code>None</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="parse_vctk" class="doc_header"><code>parse_vctk</code><a href="https://github.com/uberduck-ai/uberduck_ml_dev/tree/master/uberduck_ml_dev/utils/utils.py#L62" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>parse_vctk</code>(<strong><code>root</code></strong>)</p>
</blockquote>
<p>Parse VCTK dataset and return a dict representation.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="parse_libritts_mellotron" class="doc_header"><code>parse_libritts_mellotron</code><a href="https://github.com/uberduck-ai/uberduck_ml_dev/tree/master/uberduck_ml_dev/utils/utils.py#L141" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>parse_libritts_mellotron</code>(<strong><code>source_folder</code></strong>, <strong><code>mellotron_filelist</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="load_filepaths_and_text" class="doc_header"><code>load_filepaths_and_text</code><a href="https://github.com/uberduck-ai/uberduck_ml_dev/tree/master/uberduck_ml_dev/utils/utils.py#L116" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>load_filepaths_and_text</code>(<strong><code>filename</code></strong>, <strong><code>split</code></strong>=<em><code>'|'</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="add_speakerid" class="doc_header"><code>add_speakerid</code><a href="https://github.com/uberduck-ai/uberduck_ml_dev/tree/master/uberduck_ml_dev/utils/utils.py#L122" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>add_speakerid</code>(<strong><code>data</code></strong>, <strong><code>speaker_key</code></strong>=<em><code>0</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="parse_libritts_mellotron" class="doc_header"><code>parse_libritts_mellotron</code><a href="https://github.com/uberduck-ai/uberduck_ml_dev/tree/master/uberduck_ml_dev/utils/utils.py#L141" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>parse_libritts_mellotron</code>(<strong><code>source_folder</code></strong>, <strong><code>mellotron_filelist</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="parse_uberduck" class="doc_header"><code>parse_uberduck</code><a href="https://github.com/uberduck-ai/uberduck_ml_dev/tree/master/uberduck_ml_dev/utils/utils.py#L151" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>parse_uberduck</code>(<strong><code>source_folder</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="parse_ljspeech" class="doc_header"><code>parse_ljspeech</code><a href="https://github.com/uberduck-ai/uberduck_ml_dev/tree/master/uberduck_ml_dev/utils/utils.py#L168" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>parse_ljspeech</code>(<strong><code>source_folder</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">([</span><span class="s2">&quot;foo&quot;</span><span class="p">,</span> <span class="s2">&quot;bar&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;bar&quot;</span><span class="p">,</span> <span class="s2">&quot;baz&quot;</span><span class="p">])</span>
<span class="nb">set</span><span class="p">([</span><span class="s2">&quot;foo&quot;</span><span class="p">,</span> <span class="s2">&quot;bar&quot;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">([</span><span class="s2">&quot;bar&quot;</span><span class="p">,</span> <span class="s2">&quot;baz&quot;</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;bar&#39;}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="window_sumsquare" class="doc_header"><code>window_sumsquare</code><a href="https://github.com/uberduck-ai/uberduck_ml_dev/tree/master/uberduck_ml_dev/utils/utils.py#L190" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>window_sumsquare</code>(<strong><code>window</code></strong>, <strong><code>n_frames</code></strong>, <strong><code>hop_length</code></strong>=<em><code>200</code></em>, <strong><code>win_length</code></strong>=<em><code>800</code></em>, <strong><code>n_fft</code></strong>=<em><code>800</code></em>, <strong><code>dtype</code></strong>=<em><code>float32</code></em>, <strong><code>norm</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<h1 id="from-librosa-0.6">from librosa 0.6<a class="anchor-link" href="#from-librosa-0.6"> </a></h1><p>Compute the sum-square envelope of a window function at a given hop length.</p>
<p>This is used to estimate modulation effects induced by windowing
observations in short-time fourier transforms.</p>
<h2 id="Parameters">Parameters<a class="anchor-link" href="#Parameters"> </a></h2><p>window : string, tuple, number, callable, or list-like
    Window specification, as in <code>get_window</code></p>
<p>n_frames : int &gt; 0
    The number of analysis frames</p>
<p>hop_length : int &gt; 0
    The number of samples to advance between frames</p>
<p>win_length : [optional]
    The length of the window function.  By default, this matches <code>n_fft</code>.</p>
<p>n_fft : int &gt; 0
    The length of each analysis frame.</p>
<p>dtype : np.dtype
    The data type of the output</p>
<h2 id="Returns">Returns<a class="anchor-link" href="#Returns"> </a></h2><p>wss : np.ndarray, shape=<code>(n_fft + hop_length * (n_frames - 1))</code>
    The sum-squared envelope of the window function</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="griffin_lim" class="doc_header"><code>griffin_lim</code><a href="https://github.com/uberduck-ai/uberduck_ml_dev/tree/master/uberduck_ml_dev/utils/utils.py#L242" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>griffin_lim</code>(<strong><code>magnitudes</code></strong>, <strong><code>stft_fn</code></strong>, <strong><code>n_iters</code></strong>=<em><code>30</code></em>)</p>
</blockquote>
<h2 id="PARAMS">PARAMS<a class="anchor-link" href="#PARAMS"> </a></h2><p>magnitudes: spectrogram magnitudes
stft_fn: STFT class with transform (STFT) and inverse (ISTFT) methods</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="dynamic_range_compression" class="doc_header"><code>dynamic_range_compression</code><a href="https://github.com/uberduck-ai/uberduck_ml_dev/tree/master/uberduck_ml_dev/utils/utils.py#L261" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>dynamic_range_compression</code>(<strong><code>x</code></strong>, <strong><code>C</code></strong>=<em><code>1</code></em>, <strong><code>clip_val</code></strong>=<em><code>1e-05</code></em>)</p>
</blockquote>
<h2 id="PARAMS">PARAMS<a class="anchor-link" href="#PARAMS"> </a></h2><p>C: compression factor</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="dynamic_range_decompression" class="doc_header"><code>dynamic_range_decompression</code><a href="https://github.com/uberduck-ai/uberduck_ml_dev/tree/master/uberduck_ml_dev/utils/utils.py#L270" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>dynamic_range_decompression</code>(<strong><code>x</code></strong>, <strong><code>C</code></strong>=<em><code>1</code></em>)</p>
</blockquote>
<h2 id="PARAMS">PARAMS<a class="anchor-link" href="#PARAMS"> </a></h2><p>C: compression factor used to compress</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="to_gpu" class="doc_header"><code>to_gpu</code><a href="https://github.com/uberduck-ai/uberduck_ml_dev/tree/master/uberduck_ml_dev/utils/utils.py#L280" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>to_gpu</code>(<strong><code>x</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">to_gpu</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>tensor([[ 0.4205, -1.1850, -1.5893, -2.3392, -0.4318, -0.4430, -0.4284,  1.4317,
         -0.1496,  0.4935],
        [ 0.4623,  2.0604,  0.6541, -1.7039, -1.2048, -0.6661,  0.8831, -0.9554,
         -0.2006,  0.1072],
        [ 0.2079,  0.7801,  0.8596, -1.3201,  0.9102, -1.1626, -0.6383, -0.6470,
         -0.3793,  0.3698],
        [ 0.4690,  1.1917,  0.9150,  0.7171, -0.2825, -0.1141, -3.3621, -0.2635,
         -0.7749,  1.1867],
        [-0.1578, -0.2337,  1.0980, -1.0859,  0.2136,  0.3139,  0.5155, -1.9748,
          1.7407,  0.5734],
        [-1.5474,  0.7072,  1.1438,  1.6139, -1.1595,  0.6424,  1.1256, -0.5075,
         -0.0454,  1.2761],
        [-0.2615, -1.4330, -2.7506,  1.8179,  1.6544,  0.4992, -2.4325,  0.2401,
          0.5712,  0.6164],
        [-0.3035, -0.2399,  1.1783, -1.0322, -0.6339, -0.2631,  0.4101,  0.7904,
         -0.3742, -0.6980],
        [-0.8546,  1.5466, -0.3297, -0.0253,  0.8403, -1.0165,  0.5936, -1.0375,
         -0.9282, -1.1257],
        [ 1.6957,  0.4195, -0.1016, -1.4579, -1.1764,  0.2062,  1.2370,  1.0046,
          1.1937, -0.1407]])</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_mask_from_lengths" class="doc_header"><code>get_mask_from_lengths</code><a href="https://github.com/uberduck-ai/uberduck_ml_dev/tree/master/uberduck_ml_dev/utils/utils.py#L289" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_mask_from_lengths</code>(<strong><code>lengths</code></strong>)</p>
</blockquote>
<p>Return a mask matrix. Unmasked entires are true.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>

<span class="k">assert</span> <span class="p">(</span><span class="n">get_mask_from_lengths</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">LongTensor</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]))</span> <span class="o">==</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">([[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">],</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">],</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">],</span>  <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">]]))</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="reduce_tensor" class="doc_header"><code>reduce_tensor</code><a href="https://github.com/uberduck-ai/uberduck_ml_dev/tree/master/uberduck_ml_dev/utils/utils.py#L300" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>reduce_tensor</code>(<strong><code>tensor</code></strong>, <strong><code>n_gpus</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

</div>
 

