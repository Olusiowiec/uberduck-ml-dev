---

title: Title


keywords: fastai
sidebar: home_sidebar



nb_path: "nbs/utils.utils.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/utils.utils.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><h1>Table of Contents<span class="tocSkip"></span></h1></p>
<div class="toc"><ul class="toc-item"></ul></div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><h1>Table of Contents<span class="tocSkip"></span></h1></p>
<div class="toc"><ul class="toc-item"></ul></div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><h1>Table of Contents<span class="tocSkip"></span></h1></p>
<div class="toc"><ul class="toc-item"></ul></div>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="load_filepaths_and_text" class="doc_header"><code>load_filepaths_and_text</code><a href="https://github.com/uberduck-ai/uberduck_ml_dev/tree/master/uberduck_ml_dev/utils/utils.py#L24" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>load_filepaths_and_text</code>(<strong><code>filename</code></strong>:<code>str</code>, <strong><code>split</code></strong>:<code>str</code>=<em><code>'|'</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="synthesize_speakerids2" class="doc_header"><code>synthesize_speakerids2</code><a href="https://github.com/uberduck-ai/uberduck_ml_dev/tree/master/uberduck_ml_dev/utils/utils.py#L30" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>synthesize_speakerids2</code>(<strong><code>filelists</code></strong>, <strong><code>fix_indices_index</code></strong>=<em><code>None</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="parse_vctk" class="doc_header"><code>parse_vctk</code><a href="https://github.com/uberduck-ai/uberduck_ml_dev/tree/master/uberduck_ml_dev/utils/utils.py#L66" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>parse_vctk</code>(<strong><code>root</code></strong>:<code>str</code>)</p>
</blockquote>
<p>Parse VCTK dataset and return a dict representation.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="parse_libritts_mellotron" class="doc_header"><code>parse_libritts_mellotron</code><a href="https://github.com/uberduck-ai/uberduck_ml_dev/tree/master/uberduck_ml_dev/utils/utils.py#L137" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>parse_libritts_mellotron</code>(<strong><code>source_folder</code></strong>, <strong><code>mellotron_filelist</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="add_speakerid" class="doc_header"><code>add_speakerid</code><a href="https://github.com/uberduck-ai/uberduck_ml_dev/tree/master/uberduck_ml_dev/utils/utils.py#L119" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>add_speakerid</code>(<strong><code>data</code></strong>, <strong><code>speaker_key</code></strong>=<em><code>0</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="parse_libritts_mellotron" class="doc_header"><code>parse_libritts_mellotron</code><a href="https://github.com/uberduck-ai/uberduck_ml_dev/tree/master/uberduck_ml_dev/utils/utils.py#L137" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>parse_libritts_mellotron</code>(<strong><code>source_folder</code></strong>, <strong><code>mellotron_filelist</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="parse_uberduck" class="doc_header"><code>parse_uberduck</code><a href="https://github.com/uberduck-ai/uberduck_ml_dev/tree/master/uberduck_ml_dev/utils/utils.py#L146" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>parse_uberduck</code>(<strong><code>source_folder</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="parse_ljspeech" class="doc_header"><code>parse_ljspeech</code><a href="https://github.com/uberduck-ai/uberduck_ml_dev/tree/master/uberduck_ml_dev/utils/utils.py#L162" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>parse_ljspeech</code>(<strong><code>source_folder</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_alignment_metrics" class="doc_header"><code>get_alignment_metrics</code><a href="https://github.com/uberduck-ai/uberduck_ml_dev/tree/master/uberduck_ml_dev/utils/utils.py#L176" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_alignment_metrics</code>(<strong><code>alignments</code></strong>, <strong><code>average_across_batch</code></strong>=<em><code>True</code></em>)</p>
</blockquote>
<p>See <a href="https://github.com/NVIDIA/tacotron2/pull/284">https://github.com/NVIDIA/tacotron2/pull/284</a>,
<a href="https://github.com/CookiePPP/cookietts/blob/c871f5f7b5790656d5b57bcd9e63946a2da52f0f/CookieTTS/utils/model/utils.py#L59">https://github.com/CookiePPP/cookietts/blob/c871f5f7b5790656d5b57bcd9e63946a2da52f0f/CookieTTS/utils/model/utils.py#L59</a></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="window_sumsquare" class="doc_header"><code>window_sumsquare</code><a href="https://github.com/uberduck-ai/uberduck_ml_dev/tree/master/uberduck_ml_dev/utils/utils.py#L221" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>window_sumsquare</code>(<strong><code>window</code></strong>, <strong><code>n_frames</code></strong>, <strong><code>hop_length</code></strong>=<em><code>200</code></em>, <strong><code>win_length</code></strong>=<em><code>800</code></em>, <strong><code>n_fft</code></strong>=<em><code>800</code></em>, <strong><code>dtype</code></strong>=<em><code>float32</code></em>, <strong><code>norm</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<h1 id="from-librosa-0.6">from librosa 0.6<a class="anchor-link" href="#from-librosa-0.6"> </a></h1><p>Compute the sum-square envelope of a window function at a given hop length.</p>
<p>This is used to estimate modulation effects induced by windowing
observations in short-time fourier transforms.</p>
<h2 id="Parameters">Parameters<a class="anchor-link" href="#Parameters"> </a></h2><p>window : string, tuple, number, callable, or list-like
    Window specification, as in <code>get_window</code></p>
<p>n_frames : int &gt; 0
    The number of analysis frames</p>
<p>hop_length : int &gt; 0
    The number of samples to advance between frames</p>
<p>win_length : [optional]
    The length of the window function.  By default, this matches <code>n_fft</code>.</p>
<p>n_fft : int &gt; 0
    The length of each analysis frame.</p>
<p>dtype : np.dtype
    The data type of the output</p>
<h2 id="Returns">Returns<a class="anchor-link" href="#Returns"> </a></h2><p>wss : np.ndarray, shape=<code>(n_fft + hop_length * (n_frames - 1))</code>
    The sum-squared envelope of the window function</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="griffin_lim" class="doc_header"><code>griffin_lim</code><a href="https://github.com/uberduck-ai/uberduck_ml_dev/tree/master/uberduck_ml_dev/utils/utils.py#L280" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>griffin_lim</code>(<strong><code>magnitudes</code></strong>, <strong><code>stft_fn</code></strong>, <strong><code>n_iters</code></strong>=<em><code>30</code></em>)</p>
</blockquote>
<h2 id="PARAMS">PARAMS<a class="anchor-link" href="#PARAMS"> </a></h2><p>magnitudes: spectrogram magnitudes
stft_fn: STFT class with transform (STFT) and inverse (ISTFT) methods</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="dynamic_range_compression" class="doc_header"><code>dynamic_range_compression</code><a href="https://github.com/uberduck-ai/uberduck_ml_dev/tree/master/uberduck_ml_dev/utils/utils.py#L299" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>dynamic_range_compression</code>(<strong><code>x</code></strong>, <strong><code>C</code></strong>=<em><code>1</code></em>, <strong><code>clip_val</code></strong>=<em><code>1e-05</code></em>)</p>
</blockquote>
<h2 id="PARAMS">PARAMS<a class="anchor-link" href="#PARAMS"> </a></h2><p>C: compression factor</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="dynamic_range_decompression" class="doc_header"><code>dynamic_range_decompression</code><a href="https://github.com/uberduck-ai/uberduck_ml_dev/tree/master/uberduck_ml_dev/utils/utils.py#L308" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>dynamic_range_decompression</code>(<strong><code>x</code></strong>, <strong><code>C</code></strong>=<em><code>1</code></em>)</p>
</blockquote>
<h2 id="PARAMS">PARAMS<a class="anchor-link" href="#PARAMS"> </a></h2><p>C: compression factor used to compress</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="to_gpu" class="doc_header"><code>to_gpu</code><a href="https://github.com/uberduck-ai/uberduck_ml_dev/tree/master/uberduck_ml_dev/utils/utils.py#L317" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>to_gpu</code>(<strong><code>x</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">to_gpu</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>tensor([[ 1.0415e+00, -3.7111e-01, -3.2838e-01, -6.2205e-01, -2.6169e-01,
         -9.8103e-01, -1.8675e+00, -7.7150e-01, -1.7760e-01, -6.8241e-01],
        [-5.1025e-01, -1.1788e+00,  1.2456e+00,  1.1683e+00, -1.5050e+00,
          3.8878e-01,  3.4331e-01, -4.6678e-02, -4.9398e-01, -1.3587e+00],
        [-2.0366e+00, -2.1385e-01,  1.2572e-01,  1.0080e+00, -4.1069e-01,
         -1.1727e+00, -5.8472e-01, -1.5301e-01, -7.7718e-01, -1.4033e-01],
        [-8.1851e-01,  1.1898e+00,  3.7606e-01, -2.1779e+00,  2.1037e-01,
         -1.0227e+00,  7.8290e-01,  9.2825e-01,  1.7582e+00, -6.0930e-02],
        [-2.2755e+00, -1.9536e+00,  2.1239e-01, -6.8103e-01, -1.1368e-02,
          5.7643e-01, -6.6171e-01, -3.3325e-01, -8.7990e-01,  1.0076e+00],
        [-3.9319e-01,  8.9259e-01, -6.4939e-01, -4.6909e-01, -8.9252e-01,
          9.5496e-01,  5.3429e-02, -1.4436e-01, -1.6097e-01, -3.0059e-01],
        [-3.0589e-01, -2.9385e-02, -1.1399e+00,  1.7461e+00,  1.1013e-01,
          4.2333e-01, -1.7093e+00,  5.6877e-02,  9.2514e-01,  9.9316e-01],
        [ 4.9825e-01, -1.1996e+00,  1.6417e+00, -9.8894e-01, -4.0618e-01,
         -7.6356e-01, -9.5752e-01,  1.1703e+00,  1.3896e-01, -3.3922e-01],
        [ 8.8861e-01,  5.1271e-01, -1.6149e+00,  5.4874e-01,  5.3368e-02,
          1.0879e+00,  1.5214e-01, -1.4647e-01,  6.3347e-01, -1.5482e-03],
        [-5.4721e-01,  1.2666e+00, -1.2289e+00,  2.3877e+00,  5.3439e-01,
         -9.8616e-01, -1.8520e-01, -1.1032e+00,  7.2345e-01, -7.1658e-01]])</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_mask_from_lengths" class="doc_header"><code>get_mask_from_lengths</code><a href="https://github.com/uberduck-ai/uberduck_ml_dev/tree/master/uberduck_ml_dev/utils/utils.py#L327" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_mask_from_lengths</code>(<strong><code>lengths</code></strong>:<code>Tensor</code>, <strong><code>max_len</code></strong>:<code>int</code>=<em><code>0</code></em>)</p>
</blockquote>
<p>Return a mask matrix. Unmasked entires are true.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>

<span class="k">assert</span> <span class="p">(</span>
    <span class="n">get_mask_from_lengths</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">LongTensor</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]))</span>
    <span class="o">==</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">],</span>
            <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">],</span>
            <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">],</span>
            <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">],</span>
        <span class="p">]</span>
    <span class="p">)</span>
<span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="reduce_tensor" class="doc_header"><code>reduce_tensor</code><a href="https://github.com/uberduck-ai/uberduck_ml_dev/tree/master/uberduck_ml_dev/utils/utils.py#L339" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>reduce_tensor</code>(<strong><code>tensor</code></strong>, <strong><code>n_gpus</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="subsequent_mask" class="doc_header"><code>subsequent_mask</code><a href="https://github.com/uberduck-ai/uberduck_ml_dev/tree/master/uberduck_ml_dev/utils/utils.py#L346" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>subsequent_mask</code>(<strong><code>length</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="p">(</span><span class="n">subsequent_mask</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]]))</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="convert_pad_shape" class="doc_header"><code>convert_pad_shape</code><a href="https://github.com/uberduck-ai/uberduck_ml_dev/tree/master/uberduck_ml_dev/utils/utils.py#L351" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>convert_pad_shape</code>(<strong><code>pad_shape</code></strong>)</p>
</blockquote>
<p>Reverse, then flatten a list of lists.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">convert_pad_shape</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">]])</span> <span class="o">==</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>True</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="sequence_mask" class="doc_header"><code>sequence_mask</code><a href="https://github.com/uberduck-ai/uberduck_ml_dev/tree/master/uberduck_ml_dev/utils/utils.py#L358" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>sequence_mask</code>(<strong><code>length</code></strong>, <strong><code>max_length</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p>The same as get_mask_from_lengths</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="p">(</span>
    <span class="n">sequence_mask</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]))</span>
    <span class="o">==</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">],</span>
            <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">],</span>
            <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">],</span>
            <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">],</span>
        <span class="p">]</span>
    <span class="p">)</span>
<span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="k">assert</span> <span class="p">(</span>
    <span class="n">sequence_mask</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]),</span> <span class="mi">4</span><span class="p">)</span>
    <span class="o">==</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">],</span>
            <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">],</span>
            <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">],</span>
            <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">],</span>
        <span class="p">]</span>
    <span class="p">)</span>
<span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="generate_path" class="doc_header"><code>generate_path</code><a href="https://github.com/uberduck-ai/uberduck_ml_dev/tree/master/uberduck_ml_dev/utils/utils.py#L366" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>generate_path</code>(<strong><code>duration</code></strong>, <strong><code>mask</code></strong>)</p>
</blockquote>
<p>duration: [b, 1, t_x]
mask: [b, 1, t_y, t_x]</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="slice_segments" class="doc_header"><code>slice_segments</code><a href="https://github.com/uberduck-ai/uberduck_ml_dev/tree/master/uberduck_ml_dev/utils/utils.py#L386" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>slice_segments</code>(<strong><code>x</code></strong>, <strong><code>ids_str</code></strong>, <strong><code>segment_size</code></strong>=<em><code>4</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="rand_slice_segments" class="doc_header"><code>rand_slice_segments</code><a href="https://github.com/uberduck-ai/uberduck_ml_dev/tree/master/uberduck_ml_dev/utils/utils.py#L395" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>rand_slice_segments</code>(<strong><code>x</code></strong>, <strong><code>x_lengths</code></strong>=<em><code>None</code></em>, <strong><code>segment_size</code></strong>=<em><code>4</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="init_weights" class="doc_header"><code>init_weights</code><a href="https://github.com/uberduck-ai/uberduck_ml_dev/tree/master/uberduck_ml_dev/utils/utils.py#L405" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>init_weights</code>(<strong><code>m</code></strong>, <strong><code>mean</code></strong>=<em><code>0.0</code></em>, <strong><code>std</code></strong>=<em><code>0.01</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_padding" class="doc_header"><code>get_padding</code><a href="https://github.com/uberduck-ai/uberduck_ml_dev/tree/master/uberduck_ml_dev/utils/utils.py#L411" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_padding</code>(<strong><code>kernel_size</code></strong>, <strong><code>dilation</code></strong>=<em><code>1</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="ScriptFunction object at 0x7fa1484e9f68>" class="doc_header"><code>ScriptFunction object at 0x7fa1484e9f68></code><a href="" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>ScriptFunction object at 0x7fa1484e9f68></code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="clip_grad_value_" class="doc_header"><code>clip_grad_value_</code><a href="https://github.com/uberduck-ai/uberduck_ml_dev/tree/master/uberduck_ml_dev/utils/utils.py#L425" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>clip_grad_value_</code>(<strong><code>parameters</code></strong>, <strong><code>clip_value</code></strong>, <strong><code>norm_type</code></strong>=<em><code>2</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="intersperse" class="doc_header"><code>intersperse</code><a href="https://github.com/uberduck-ai/uberduck_ml_dev/tree/master/uberduck_ml_dev/utils/utils.py#L443" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>intersperse</code>(<strong><code>lst</code></strong>, <strong><code>item</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">intersperse</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>True</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

