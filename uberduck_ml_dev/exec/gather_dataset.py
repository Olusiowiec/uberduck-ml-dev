# AUTOGENERATED! DO NOT EDIT! File to edit: nbs/exec.gather_dataset.ipynb (unless otherwise specified).

__all__ = []

# Cell

import argparse
import os
from typing import List
import sys
from zipfile import ZipFile


def _gather(filelist, output):
    with open(filelist, "r") as f:
        lines = f.readlines()
    paths = [l.split("|")[0] for l in lines]
    common_prefix = os.path(paths)
    archive_paths = []
    for p in paths:
        relpath = os.path.relpath(p, common_prefix)
        archive_paths.append(relpath)
    _, filelist_archive = os.path.split(filelist)
    with ZipFile(output, "w") as zf:
        zf.write(filelist, filelist_archive)
        for path, archive_path in zip(paths, archive_paths):
            zf.write(path, archive_path)


def _parse_args(args: List[str]):
    parser = argparse.ArgumentParser()
    parser.add_argument("-i", "--input", help="Path to input filelist")
    parser.add_argument(
        "-o",
        "--output",
        help="Output zipfile",
        default="out.zip",
    )
    return parser.parse_args(args)


try:
    from nbdev.imports import IN_NOTEBOOK
except:
    IN_NOTEBOOK = False

if __name__ == "__main__" and not IN_NOTEBOOK:
    args = _parse_args(sys.argv[1:])
    _generate_filelist(args.input, args.format, args.output)